{% extends "vistoria/base_vistoria.html" %}
{% block title %}+ Sem registro — {{ sala.nome }}{% endblock %}

{% block page_prefix %}<i class="bi bi-clipboard-plus"></i> Sem registro{% endblock %}
{% block page_title %}Novo item{% endblock %}
{% block page_subtitle %}{{ sala.nome }}{% if sala.bloco %} — {{ sala.bloco }}{% endif %}{% endblock %}
{% block page_actions %}
  <a class="btn btn-outline-secondary" href="{% url 'vistoria_public:sala_workspace' sala_id=sala.id %}">
    <i class="bi bi-arrow-left"></i> Voltar
  </a>
{% endblock %}

{% block content %}
  <form id="form-extra" method="post" enctype="multipart/form-data" class="mb-3">
    {% csrf_token %}

    <div class="card shadow-sm mb-3">
      <div class="card-body">
        <div class="fw-semibold mb-2"><i class="bi bi-camera"></i> Foto</div>
        <input class="form-control" type="file" name="foto" accept="image/*" capture="environment" required />
      </div>
    </div>

    <div class="card shadow-sm mb-3">
      <div class="card-body">
        <div class="fw-semibold mb-2"><i class="bi bi-info-circle"></i> Dados observados</div>

        <div class="mb-3">
          <label class="form-label">Descrição observada</label>
          <textarea class="form-control" name="descricao_obs" required></textarea>
        </div>

        <div class="row g-2">
          <div class="col-12 col-md-6">
            <label class="form-label">Número de série (opcional)</label>
            <input class="form-control" type="text" name="numero_serie_obs" />
          </div>
          <div class="col-12 col-md-6">
            <label class="form-label">Estado (opcional)</label>
            <input class="form-control" type="text" name="estado_obs" />
          </div>
        </div>

        <div class="mt-2">
          <label class="form-label">Responsável/usuário (opcional)</label>
          <input class="form-control" type="text" name="responsavel_obs" />
        </div>

        <div class="form-check mt-3">
          <input class="form-check-input" type="checkbox" id="cb-etq" name="etiqueta_possui">
          <label class="form-check-label" for="cb-etq">Possui etiqueta?</label>
        </div>

        <div class="mt-2">
          <label class="form-label" for="sel-etq-cond">Condição da etiqueta</label>
          <select class="form-select" name="etiqueta_condicao" id="sel-etq-cond">
            <option value="">— Condição —</option>
            {% for key,val in etiqueta_choices %}
              <option value="{{ key }}">{{ val }}</option>
            {% endfor %}
          </select>
        </div>

        <div class="mt-3">
          <label class="form-label">Observações (opcional)</label>
          <textarea class="form-control" name="observacoes"></textarea>
        </div>
      </div>
    </div>

    <div class="d-grid">
      <button class="btn btn-primary btn-lg" type="submit"><i class="bi bi-save"></i> Salvar item sem registro</button>
    </div>
  </form>
{% endblock %}

{% block extra_js %}
<script>
(function(){
  const f=document.getElementById('form-extra'); if(!f) return;
  const cb=f.querySelector('#cb-etq'); const sel=f.querySelector('#sel-etq-cond');
  function sync(){ if(sel){ sel.disabled=!cb.checked; if(!cb.checked) sel.selectedIndex=0; } }
  if(cb){ sync(); cb.addEventListener('change',sync); }
})();
</script>
{% endblock %}
