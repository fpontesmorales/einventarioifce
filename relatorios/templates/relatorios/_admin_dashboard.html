{# usa apenas Bootstrap utilitários #}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h2 class="h4 mb-0">Resumo do Inventário</h2>
  <div class="btn-group">
    <a class="btn btn-primary" href="{% url 'relatorios:final' %}">Relatório Final</a>
    <a class="btn btn-outline-primary" href="{% url 'relatorios:operacional' %}">Operacional</a>
    <a class="btn btn-outline-secondary" href="{% url 'relatorios:inventario_por_conta' %}">Por Conta</a>
    <a class="btn btn-outline-secondary" href="{% url 'relatorios:mapa_nc' %}">Mapa NC</a>
    <a class="btn btn-outline-secondary" href="{% url 'relatorios:exportar_fotos' %}">Exportar fotos</a>
  </div>
</div>

<div class="row row-cols-1 row-cols-md-6 g-3 mb-3">
  <div class="col">
    <div class="card h-100 text-center">
      <div class="card-header">Elegíveis</div>
      <div class="card-body"><div class="display-6">{{ elegiveis }}</div></div>
    </div>
  </div>
  <div class="col">
    <div class="card h-100 text-center">
      <div class="card-header">Vistoriados</div>
      <div class="card-body"><div class="display-6">{{ vist }}</div></div>
    </div>
  </div>
  <div class="col">
    <div class="card h-100 text-center">
      <div class="card-header">Cobertura</div>
      <div class="card-body">
        <div class="display-6">{{ cobertura|floatformat:1 }}%</div>
        <div class="progress mt-2" role="progressbar" aria-valuenow="{{ cobertura|floatformat:0 }}" aria-valuemin="0" aria-valuemax="100">
          <div class="progress-bar" style="width: {{ cobertura|floatformat:0 }}%;"></div>
        </div>
      </div>
    </div>
  </div>
  <div class="col">
    <div class="card h-100 text-center">
      <div class="card-header">Divergentes</div>
      <div class="card-body"><div class="display-6">{{ diverg }}</div></div>
    </div>
  </div>
  <div class="col">
    <div class="card h-100 text-center">
      <div class="card-header">Não encontrados</div>
      <div class="card-body"><div class="display-6">{{ nao }}</div></div>
    </div>
  </div>
  <div class="col">
    <div class="card h-100 text-center">
      <div class="card-header">Sem registro</div>
      <div class="card-body"><div class="display-6">{{ extras }}</div></div>
    </div>
  </div>
</div>

<div class="row g-3">
  <div class="col-lg-7">
    <div class="card h-100">
      <div class="card-header d-flex justify-content-between align-items-center">
        <span>Produção — últimos 14 dias</span>
        <small class="text-muted">Total 7d: {{ total7 }} | Pico/Vale: {{ pico7 }}/{{ vale7 }}</small>
      </div>
      <div class="card-body">
        <div class="table-responsive">
          <table class="table table-sm align-middle mb-0">
            <thead class="table-light">
              <tr><th style="width: 90px;">Data</th><th style="width: 80px;">Itens</th><th>Progresso</th></tr>
            </thead>
            <tbody>
              {% for p in series14 %}
                <tr>
                  <td>{{ p.data|date:"d/m" }}</td>
                  <td>{{ p.qtd }}</td>
                  <td>
                    <div class="progress" role="progressbar" aria-valuenow="{{ p.pct }}" aria-valuemin="0" aria-valuemax="100">
                      <div class="progress-bar" style="width: {{ p.pct }}%;"></div>
                    </div>
                  </td>
                </tr>
              {% empty %}
                <tr><td colspan="3" class="text-muted">Sem lançamentos.</td></tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
      {% if dias_rest %}
      <div class="card-footer d-flex justify-content-between align-items-center">
        <div>Restam <strong>{{ dias_rest }}</strong> dia(s). Meta diária para 100%: <strong>{{ meta_dia|floatformat:0 }}</strong> Itens/dia.</div>
        {% if status_meta %}
          {% if status_meta == "adiantado" %}
            <span class="badge text-bg-success">Adiantado</span>
          {% else %}
            <span class="badge text-bg-warning">Atrasado</span>
          {% endif %}
        {% endif %}
      </div>
      {% endif %}
    </div>
  </div>

  <div class="col-lg-5">
    <div class="card h-100">
      <div class="card-header">Top pendências por bloco</div>
      <div class="card-body">
        <div class="table-responsive">
          <table class="table table-sm align-middle mb-0">
            <thead class="table-light">
              <tr><th>Bloco</th><th style="width: 80px;">Pend.</th><th>Progresso</th></tr>
            </thead>
            <tbody>
              {% for r in top_blocos %}
                <tr>
                  <td class="text-uppercase">{{ r.bloco }}</td>
                  <td>{{ r.pend }}</td>
                  <td>
                    {% with pct=r.pend|add:0 %}
                      <div class="progress" role="progressbar">
                        <div class="progress-bar" style="width: {% widthratio r.pend top_blocos.0.pend 100 %}%"></div>
                      </div>
                    {% endwith %}
                  </td>
                </tr>
              {% empty %}
                <tr><td colspan="3" class="text-muted">Sem dados.</td></tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
      <div class="card-footer">
        <div class="d-grid gap-2 d-md-flex">
          <a class="btn btn-outline-secondary btn-sm" href="{% url 'relatorios:operacional' %}">Abrir pendências</a>
          <a class="btn btn-outline-secondary btn-sm" href="{% url 'relatorios:final' %}">Relatório final</a>
        </div>
      </div>
    </div>
  </div>
</div>
