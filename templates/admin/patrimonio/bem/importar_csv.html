{% extends "admin/base_site.html" %}
{% load i18n %}

{% block extrastyle %}
<style>
  .import-overlay {
    display: none; position: fixed; inset: 0;
    background: rgba(255,255,255,.85); z-index: 9999;
    align-items: center; justify-content: center; flex-direction: column;
  }
  .progress-wrap { width: min(480px, 90vw); }
  .progress-bar {
    height: 8px; width: 100%; background: #e5e7eb; border-radius: 6px; overflow: hidden;
    box-shadow: inset 0 0 0 1px rgba(0,0,0,.05);
  }
  .progress-fill {
    height: 100%; width: 0; background: #28a745; animation: load 2.2s infinite;
  }
  @keyframes load {
    0%   { width: 0% }
    50%  { width: 80% }
    100% { width: 100% }
  }
</style>
{% endblock %}

{% block content %}
  <h1>Importar CSV do SUAP</h1>
  <p>Envie o arquivo CSV exportado diretamente do SUAP (UTF-8). Durante o processamento, aguarde — pode levar alguns minutos.</p>

  <form id="import-form" method="post" enctype="multipart/form-data" novalidate>
    {% csrf_token %}
    <fieldset class="module aligned">
      {{ form.as_p }}
    </fieldset>
    <div class="submit-row">
      <input id="submit-btn" type="submit" value="Enviar e importar" class="default">
      <a href="{% url 'admin:patrimonio_bem_changelist' %}" class="button cancel-link">Cancelar</a>
    </div>
  </form>

  <div id="overlay" class="import-overlay">
    <div class="progress-wrap">
      <h2 style="margin-bottom:12px; text-align:center;">Processando arquivo…</h2>
      <div class="progress-bar"><div class="progress-fill"></div></div>
      <p style="text-align:center; margin-top:10px; color:#444;">
        Não feche esta janela. A importação pode levar alguns minutos.
      </p>
    </div>
  </div>
{% endblock %}

{% block extrahead %}
<script>
document.addEventListener('DOMContentLoaded', function(){
  const form = document.getElementById('import-form');
  const overlay = document.getElementById('overlay');
  const submit = document.getElementById('submit-btn');
  if (form && overlay && submit) {
    form.addEventListener('submit', function(){
      overlay.style.display = 'flex';
      submit.disabled = true;
      submit.value = 'Enviando…';
    });
  }
});
</script>
{% endblock %}
